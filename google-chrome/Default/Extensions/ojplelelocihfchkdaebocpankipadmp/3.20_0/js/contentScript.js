var port,currentTabId,extensionVersion,extensionName;class DDMEventHandler{static setupPort(){port||((port=chrome.runtime.connect(null,{name:"ScopusDDMExtension"})).postMessage({type:"init-from-cs"}),port.onDisconnect.addListener(function(){port=null}),port.onMessage.addListener(DDMEventHandler.handleMessage))}static handleMessage(e){"init-response-to-cs"===e.type?(currentTabId=e.tabId,extensionName=e.extensionName,extensionVersion=e.extensionVersion):"response-to-cs"===e.type&&(e.extensionVersion=extensionVersion,DDMEventHandler._responseEvent(e))}static handleRequest(e){DDMEventHandler.setupPort();var t=e.detail;"TestCommunication"===t.action?DDMEventHandler.testCommunication(e):port.postMessage({type:"request-from-cs",data:t,tabId:currentTabId,extensionName:extensionName})}static testCommunication(e){var t=document.createElement("div");t.id="DDMExtension-testelementid",t.style.visibility="hidden",t.setAttribute("class","DDMExtension-testelement"),t.setAttribute("data-extension-loaded","true");try{port.postMessage({type:"test-from-cs"}),t.setAttribute("data-extension-enabled","true"),t.setAttribute("data-extension-version",extensionVersion)}catch(e){console.error(e),t.setAttribute("data-extension-enabled","false")}document.body.appendChild(t)}static _responseEvent(e){var t=new CustomEvent("DDMResponseEvent",{detail:JSON.stringify(DDMEventHandler._removeExtensionAttributes(e))});document.dispatchEvent(t)}static _removeExtensionAttributes(e){return delete e.type,e}}document.addEventListener("DDMRequestEvent",DDMEventHandler.handleRequest),document.addEventListener("DOMContentLoaded",DDMEventHandler.setupPort);